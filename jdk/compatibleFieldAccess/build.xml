<?xml version="1.0" encoding="UTF-8"?>
<project name="compatibleFieldAccess" default="test">
	<description>
            description
    </description>

	<!-- ================================= 
          target: default              
         ================================= -->
	<target name="test" depends="test-disabled,test-enabled" description="description" />
	
	<target name="test-disabled" depends="jar,compile-test">
		<mkdir dir="tmp" />
		<java classname="AllInOneTest" fork="true">
			<classpath>
				<path location="output-test" />
				<path location="gen" />
			</classpath>
		</java>
	</target>
	<target name="test-enabled" depends="jar,compile-test">
		<mkdir dir="tmp" />
		<java classname="AllInOneTest" fork="true">
			<jvmarg line="-javaagent:transformer.jar" />
			<classpath>
				<path location="output-test" />
				<path location="gen" />
				<path refid="libs" />
			</classpath>
		</java>
	</target>

	<target name="jar" depends="compile">
		<jar destfile="transformer.jar" manifest="MANIFEST.MF">
			<fileset dir="output">
				<include name="**/*.class" />
			</fileset>
		</jar>
	</target>

	<path id="libs">
		<fileset dir="libs">
			<include name="*.jar" />
			<exclude name="Accessor.class" />
		</fileset>
	</path>

	<target name="compile-test" depends="jar,generate">
		<mkdir dir="output-test" />
		<javac includeantruntime="false" srcdir="testsrc" destdir="output-test" debug="on">
			<classpath>
				<path location="gen">
				</path>
				<path location="output">
				</path>
			</classpath>
		</javac>
	</target>

	<target name="compile">
		<mkdir dir="output" />
		<javac includeantruntime="false" srcdir="src" destdir="output" classpathref="libs" debug="on" />
	</target>

	<target name="generate" depends="compile-generator">
		<mkdir dir="gen" />
		<java fork="true" classname="GEN">
			<classpath>
				<path refid="libs" />
				<path location="output-generator" />
			</classpath>
		</java>
	</target>

	<target name="compile-generator">
		<mkdir dir="output-generator" />
		<javac includeantruntime="false" srcdir="generator" destdir="output-generator" classpathref="libs" debug="on" />
	</target>

	<target name="clean" description="clean">
		<delete dir="gen">
		</delete>
		<delete dir="output">
		</delete>
		<delete dir="output-transformer">
		</delete>
		<delete dir="output-test">
		</delete>
		<delete dir="output-generator">
		</delete>
		<delete dir="tmp">
		</delete>
	</target>
</project>
